(()=>{var R=({areGroupsCollapsedByDefault:c,canTrackDeselectedRecords:h,currentSelectionLivewireProperty:l,maxSelectableRecords:s,selectsCurrentPageOnly:i,selectsGroupsOnly:d,$wire:r})=>({checkboxClickController:null,groupVisibility:[],isLoading:!1,selectedRecords:new Set,deselectedRecords:new Set,isTrackingDeselectedRecords:!1,shouldCheckUniqueSelection:!0,lastCheckedRecord:null,livewireId:null,entangledSelectedRecords:l?r.$entangle(l):null,init(){this.livewireId=this.$root.closest("[wire\\:id]")?.attributes["wire:id"].value,r.$on("deselectAllTableRecords",()=>this.deselectAllRecords()),r.$on("scrollToTopOfTable",()=>this.$root.scrollIntoView({block:"start",inline:"nearest"})),l&&(s!==1?this.selectedRecords=new Set(this.entangledSelectedRecords):this.selectedRecords=new Set(this.entangledSelectedRecords?[this.entangledSelectedRecords]:[])),this.$nextTick(()=>this.watchForCheckboxClicks()),Livewire.hook("element.init",({component:e})=>{e.id===this.livewireId&&this.watchForCheckboxClicks()})},mountAction(...e){r.set("isTrackingDeselectedTableRecords",this.isTrackingDeselectedRecords,!1),r.set("selectedTableRecords",[...this.selectedRecords],!1),r.set("deselectedTableRecords",[...this.deselectedRecords],!1),r.mountAction(...e)},toggleSelectRecordsOnPage(){let e=this.getRecordsOnPage();if(this.areRecordsSelected(e)){this.deselectRecords(e);return}this.selectRecords(e)},toggleSelectRecords(e){this.areRecordsSelected(e)?this.deselectRecords(e):this.selectRecords(e)},getSelectedRecordsCount(){return this.isTrackingDeselectedRecords?(this.$refs.allSelectableRecordsCount?.value??this.deselectedRecords.size)-this.deselectedRecords.size:this.selectedRecords.size},getRecordsOnPage(){let e=[];for(let t of this.$root?.getElementsByClassName("fi-ta-record-checkbox")??[])e.push(t.value);return e},selectRecords(e){s===1&&(this.deselectAllRecords(),e=e.slice(0,1));for(let t of e)if(!this.isRecordSelected(t)){if(this.isTrackingDeselectedRecords){this.deselectedRecords.delete(t);continue}this.selectedRecords.add(t)}this.updatedSelectedRecords()},deselectRecords(e){for(let t of e){if(this.isTrackingDeselectedRecords){this.deselectedRecords.add(t);continue}this.selectedRecords.delete(t)}this.updatedSelectedRecords()},updatedSelectedRecords(){if(s!==1){this.entangledSelectedRecords=[...this.selectedRecords];return}this.entangledSelectedRecords=[...this.selectedRecords][0]??null},toggleSelectedRecord(e){if(this.isRecordSelected(e)){this.deselectRecords([e]);return}this.selectRecords([e])},async selectAllRecords(){if(!h||i){this.isLoading=!0,this.selectedRecords=new Set(await r.getAllSelectableTableRecordKeys()),this.updatedSelectedRecords(),this.isLoading=!1;return}this.isTrackingDeselectedRecords=!0,this.selectedRecords=new Set,this.deselectedRecords=new Set,this.updatedSelectedRecords()},canSelectAllRecords(){if(i){let o=this.getRecordsOnPage();return!this.areRecordsSelected(o)&&this.areRecordsToggleable(o)}let e=parseInt(this.$refs.allSelectableRecordsCount?.value);if(!e)return!1;let t=this.getSelectedRecordsCount();return e===t?!1:s===null||e<=s},deselectAllRecords(){this.isTrackingDeselectedRecords=!1,this.selectedRecords=new Set,this.deselectedRecords=new Set,this.updatedSelectedRecords()},isRecordSelected(e){return this.isTrackingDeselectedRecords?!this.deselectedRecords.has(e):this.selectedRecords.has(e)},areRecordsSelected(e){return e.every(t=>this.isRecordSelected(t))},areRecordsToggleable(e){if(s===null||s===1)return!0;let t=e.filter(o=>this.isRecordSelected(o));return t.length===e.length?!0:this.getSelectedRecordsCount()+(e.length-t.length)<=s},toggleCollapseGroup(e){this.isGroupCollapsed(e)?c?this.groupVisibility.push(e):this.groupVisibility.splice(this.groupVisibility.indexOf(e),1):c?this.groupVisibility.splice(this.groupVisibility.indexOf(e),1):this.groupVisibility.push(e)},isGroupCollapsed(e){return c?!this.groupVisibility.includes(e):this.groupVisibility.includes(e)},resetCollapsedGroups(){this.groupVisibility=[]},watchForCheckboxClicks(){this.checkboxClickController&&this.checkboxClickController.abort(),this.checkboxClickController=new AbortController;let{signal:e}=this.checkboxClickController;this.$root?.addEventListener("click",t=>t.target?.matches(".fi-ta-record-checkbox")&&this.handleCheckboxClick(t,t.target),{signal:e})},handleCheckboxClick(e,t){if(!this.lastChecked){this.lastChecked=t;return}if(e.shiftKey){let o=Array.from(this.$root?.getElementsByClassName("fi-ta-record-checkbox")??[]);if(!o.includes(this.lastChecked)){this.lastChecked=t;return}let u=o.indexOf(this.lastChecked),m=o.indexOf(t),g=[u,m].sort((n,p)=>n-p),a=[];for(let n=g[0];n<=g[1];n++)a.push(o[n].value);if(t.checked){if(!this.areRecordsToggleable(a)){t.checked=!1,this.deselectRecords([t.value]);return}this.selectRecords(a)}else this.deselectRecords(a)}this.lastChecked=t}});function f({columns:c,isLive:h}){return{error:void 0,isLoading:!1,columns:c,isLive:h,init(){if(!this.columns||this.columns.length===0){this.columns=[];return}},get groupedColumns(){let l={};return this.columns.filter(s=>s.type==="group").forEach(s=>{l[s.name]=this.calculateGroupedColumns(s)}),l},calculateGroupedColumns(l){if((l?.columns?.filter(e=>!e.isHidden)??[]).length===0)return{hidden:!0,checked:!1,disabled:!1,indeterminate:!1};let i=l.columns.filter(e=>!e.isHidden&&e.isToggleable!==!1);if(i.length===0)return{checked:!0,disabled:!0,indeterminate:!1};let d=i.filter(e=>e.isToggled).length,r=l.columns.filter(e=>!e.isHidden&&e.isToggleable===!1);return d===0&&r.length>0?{checked:!0,disabled:!1,indeterminate:!0}:d===0?{checked:!1,disabled:!1,indeterminate:!1}:d===i.length?{checked:!0,disabled:!1,indeterminate:!1}:{checked:!0,disabled:!1,indeterminate:!0}},getColumn(l,s=null){return s?this.columns.find(d=>d.type==="group"&&d.name===s)?.columns?.find(d=>d.name===l):this.columns.find(i=>i.name===l)},toggleGroup(l){let s=this.columns.find(t=>t.type==="group"&&t.name===l);if(!s?.columns)return;let i=this.calculateGroupedColumns(s);if(i.disabled)return;let r=s.columns.filter(t=>t.isToggleable!==!1).some(t=>t.isToggled),e=i.indeterminate?!0:!r;s.columns.filter(t=>t.isToggleable!==!1).forEach(t=>{t.isToggled=e}),this.columns=[...this.columns],this.isLive&&this.applyTableColumnManager()},toggleColumn(l,s=null){let i=this.getColumn(l,s);!i||i.isToggleable===!1||(i.isToggled=!i.isToggled,this.columns=[...this.columns],this.isLive&&this.applyTableColumnManager())},reorderColumns(l){let s=l.map(i=>i.split("::"));this.reorderTopLevel(s),this.isLive&&this.applyTableColumnManager()},reorderGroupColumns(l,s){let i=this.columns.find(e=>e.type==="group"&&e.name===s);if(!i)return;let d=l.map(e=>e.split("::")),r=[];d.forEach(([e,t])=>{let o=i.columns.find(u=>u.name===t);o&&r.push(o)}),i.columns=r,this.columns=[...this.columns],this.isLive&&this.applyTableColumnManager()},reorderTopLevel(l){let s=this.columns,i=[];l.forEach(([d,r])=>{let e=s.find(t=>d==="group"?t.type==="group"&&t.name===r:d==="column"?t.type!=="group"&&t.name===r:!1);e&&i.push(e)}),this.columns=i},async applyTableColumnManager(){this.isLoading=!0;try{await this.$wire.call("applyTableColumnManager",this.columns),this.error=void 0}catch(l){this.error="Failed to update column visibility",console.error("Table toggle columns error:",l)}finally{this.isLoading=!1}}}}document.addEventListener("alpine:init",()=>{window.Alpine.data("filamentTable",R),window.Alpine.data("filamentTableColumnManager",f)});})();
